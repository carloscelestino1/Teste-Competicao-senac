{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}

{% block content %}
<link rel="stylesheet" href="{% static 'styles/main/dashboard.css' %}">

<style>
    .dashboard-wrapper {
        padding: 2rem;
        background-color: #f9faff;
    }

    .top-row {
        display: flex;
        flex-wrap: wrap;
        gap: 24px;
        justify-content: space-between;
        margin-bottom: 2rem;
    }

    .card-section,
    .chart-section {
        background-color: #fff;
        padding: 1.5rem;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        flex: 1;
        min-width: 320px;
    }

    .card-section h2,
    .chart-section h2 {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 1rem;
        color: #333;
    }

    .cards-wrapper {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .card {
        font-size: 1.1rem;
        padding: 1rem;
        border-radius: 12px;
        font-weight: bold;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        min-height: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .card-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-top: 4px;
    }

    .available {
        color: #00ca07;
        border: 2px solid #00ca07;
        background-color: #ecfff0;
    }

    .reserved {
        color: #f44528;
        border: 2px solid #f44528;
        background-color: #fff0ec;
    }

.bottom-row {
    background-color: #fff;
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    margin-top: 2rem;

    /* NOVO: ocupa toda a linha e herda largura da row anterior */
    display: block;
    flex-basis: 100%;
}


.bottom-row canvas {
    width: 100% !important;
    max-width: 100%;
    height: 380px !important;
}




    .bottom-row h2 {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 1rem;
    }

    canvas {
        width: 100% !important;
        height: auto !important;
        display: block;
    }



    header.flex {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 1rem 2rem;
    }

    header h1 {
        font-size: 1.8rem;
        margin: 0;
    }

    .full-width-row {
    width: 100%;
    display: flex;
    justify-content: center;
}

.columnchart {
    width: 100%;
    max-width: 100%;
    background-color: #fff;
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    margin-top: 2rem;
}

.columnchart h2 {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 1rem;
}

.columnchart canvas {
    width: 100% !important;
    max-width: 100%;
    height: 400px !important;
}

</style>

<header class="flex">
    <a href="{% url 'events_list' %}">
        <img src="{% static 'icons/back.svg' %}" alt="Voltar">
    </a>
    <h1>Dashboard: {{ event.title }}</h1>
</header>

<main class="dashboard-wrapper">

    <div class="top-row">

        <!-- Resumo -->
        <section class="card-section">
            <h2>Resumo de Ingressos</h2>
            <div class="cards-wrapper">
                <div class="card available">
                    <div>Ingressos Disponíveis</div>
                    <div class="card-value">{{ disponiveis }}</div>
                </div>
                <div class="card reserved">
                    <div>Ingressos Reservados</div>
                    <div class="card-value">{{ emitidos }}</div>
                </div>
            </div>
        </section>

        <!-- Gráfico de Pizza -->
        <section class="chart-section">
            <h2>Distribuição de Ingressos</h2>
            <canvas id="pie"></canvas>
        </section>

    </div>

    <!-- Gráfico de Barras -->
<!-- Gráfico de Barras em container separado -->
    <div class="full-width-row">
        <section class="columnchart">
            <h2>% de Vendas por Setor</h2>
            <canvas id="column"></canvas>
        </section>
    </div>

</main>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Gráfico de Pizza
    const ctx2 = document.getElementById('pie');
    new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['% Disponíveis', '% Reservados'],
            datasets: [{
                label: 'Porcentagem',
                data: [{{ percent_disponiveis }}, {{ percent_emitidos }}],
                backgroundColor: ['#00CA07', '#F44528'],
                hoverOffset: 4
            }]
        }
    });

    // Gráfico de Barras
    const ctx = document.getElementById('column');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ labels|safe }},
            datasets: [{
                label: '% de Vendas por Setor',
                data: {{ percentuais|safe }},
                backgroundColor: '#F44528',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
</script>
{% endblock %}
